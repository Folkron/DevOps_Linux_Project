#!/bin/bash

LOG_DIR="../ex04/logs"
LOG_FILE="$LOG_DIR/access_1.log"

# Проверяем, передан ли параметр
if [ "$#" -ne 1 ]; then
    echo "Использование: $0 <1 - сортировка по коду, 2 - уникальные IP, 3 - ошибки, 4 - IP с ошибками>"
    exit 1
fi

OPTION="$1"

# Проверяем, существует ли лог-файл
if [ ! -f "$LOG_FILE" ]; then
    echo "Ошибка: Лог-файл $LOG_FILE не найден!"
    exit 1
fi

# Обработка параметра
case "$OPTION" in
    1)  # Сортировка по коду ответа
        echo "Сортировка по коду ответа:"
        awk '{print $9, $0}' "$LOG_FILE" | sort -n
        ;;
    2)  # Вывод уникальных IP
        echo "Уникальные IP-адреса:"
        awk '{print $1}' "$LOG_FILE" | sort | uniq
        ;;
    3)  # Вывод запросов с ошибками
        echo "Запросы с ошибками (4xx и 5xx):"
        awk '$9 ~ /^[45][0-9][0-9]$/ {print $0}' "$LOG_FILE"
        ;;
    4)  # Уникальные IP, вызвавшие ошибки
        echo "IP-адреса, вызвавшие ошибки:"
        awk '$9 ~ /^[45][0-9][0-9]$/ {print $1}' "$LOG_FILE" | sort | uniq
        ;;
    *)
        echo "Ошибка: Неверный параметр!"
        exit 1
        ;;
esac
